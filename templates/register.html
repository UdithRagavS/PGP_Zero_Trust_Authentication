<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    .flash-success { color: green; font-weight: bold; }
    .flash-error { color: red; font-weight: bold; }
    body { font-family: Arial, sans-serif; margin: 2em; }
    textarea { width: 100%; font-family: monospace; }
  </style>
</head>
<body>
  <h2>Register User</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <p class="flash-{{category}}">{{ message }}</p>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST" autocomplete="off" id="registerForm">
    <label>Username:</label><br>
    <input type="text" name="username" autocomplete="off" required><br><br>

    <label>PGP Public Key:</label><br>
    <textarea name="pgp_key" rows="8" cols="50" autocomplete="off" required></textarea><br><br>

    <button type="submit">Register</button>
  </form>

  <p><a href="{{ url_for('home') }}">â¬… Back to Home</a></p>

  <script>
    // When the page is shown from bfcache / history, clear the form
    window.addEventListener('pageshow', function (event) {
      // event.persisted is true when coming from back-forward cache in some browsers
      // We reset the form to ensure no previous values are shown
      const form = document.getElementById('registerForm');
      if (form) form.reset();

      // Extra: if navigation type is 'back_forward', reload to ensure fresh content
      // (only do this if you prefer a hard reload; commented out by default)
      // if (performance.getEntriesByType("navigation")[0]?.type === 'back_forward') {
      //   window.location.reload(true);
      // }
    });

    // Remove any autofill values immediately on page load for extra safety
    window.addEventListener('load', function () {
      const form = document.getElementById('registerForm');
      if (form) {
        Array.from(form.elements).forEach(el => {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.value = '';
          }
        });
      }
    });
  </script>
</body>
</html>
